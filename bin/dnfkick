#!/usr/bin/env python3

"""Script for installing packages from a package list using dnf"""

import os
import subprocess
import sys

def parse_file(filename):
    """Parses a kick file or directory of kick files

    Each file should a list of package names, with one per line
    """
    install, remove = [], []
    for line in open(filename):
        line = line.strip()
        comment = line.find('#')
        if comment >= 0:
            line = line[:comment]
        if line.startswith('-'):
            remove.append(line[1:].strip())
        elif line:
            install.append(line)
    return install, remove


def kick(path):
    """Runs dnf kick on the given file path"""
    if os.path.isdir(path):
        for root, _, filenames in os.walk(path):
            for filename in filenames:
                kick(os.path.join(root, filename))
    else:
        install, remove = parse_file(path)
        if install:
            cmd = ['dnf', 'install', '--allowerasing', '--assumeyes'] + install
            subprocess.call(cmd)
        if remove:
            cmd = ['dnf', 'remove', '--assumeyes'] + remove
            subprocess.call(cmd)

if __name__ == '__main__':
    for arg in sys.argv[1:]:
        kick(arg)
